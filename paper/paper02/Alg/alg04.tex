%
% line numbering
%
\renewcommand{\LinesNumbered}{%
	\setboolean{algocf@linesnumbered}{true}%
	\renewcommand{\algocf@linesnumbered}{\everypar={\nl}}}%

\let\oldnl\nl% Store \nl in \oldnl
\newcommand{\nonl}{\renewcommand{\nl}{\let\nl\oldnl}}% Remove line number for one line

\ifdefined\varInputAlgos%
\renewcommand{\arraystretch}{1.90}%
%\todo{Do we mean non-recycling or not circulating?}%
\begin{algorithm*}[!h]%
	\DontPrintSemicolon
	\caption{$GetMCirc$: Measure $\protect\MCirc$ for given transaction $t$, $\typett$ \acs*{wbaType} within window $\wndw$.%
	}\label{algo:code_mcirc}%
	%
	%
%	\KwData{$ \Out^{\cbs}$                                                                    \tcc*{Set of maps of coinbase outputs per blockheight, that represent transaction fees}}%
	$\MCirc \gets {0}$                                                                        \tcc*{Money supply to be estimated for given arguments}%
	\lIf(                                                                                     \tcc*[f]{Return transactions without any inputs to be added}){$\isCoinbase(t)\ \orbf\ \sum_{i\in{}\Inp_{t}} \val(i)\,=\,0$}{return $0$}%

	\ForEach {$i \in \Inp_{t}$\label{algo:code_mcirc_for}%
	}{%
		\If(                                                                                  \tcc*[f]{Input $i$ was generated before $\wndw_\Start$ regardless of the transaction type}){%
		$\dateGen(i) < \wndw_\Start$
		}{%        
			$ \MCirc \gets{\MCirc\,+\,\val(i)} $                                             \tcc*{Add the full value of $i$}%
		}% 
		\tcc*{Special handling of inputs generated by coinbase txes within window}
		\If(                                                                                  ){%
			$\dateGen(i) \ge \wndw_\Start~\andbf~\genByCoinbase(i)$
		}{%
%			$\Out^{\cbs}_{i} \gets{\Out^{\cbs}[\bhSpentTx(i)]}$                               \tcc*{Get map of outputs of the coinbase tx that is spent by input $i$}%
%			$\keyInp \gets {(\addr(i),\ \val(i))}$                                            \tcc*{dictionary/map key for $\Out^{\cbs}_{i}$, supposed to be unique}%
%			\eIf(                                                                              \tcc*[f]{Check wheather $i$ represents fees}%
%			){$\keyInp \in \keys(\Out^{\cbs}_{i})$
%			}{%
%				$\minedRemIndex \gets {\Out^{\cbs}_{i}[\mathtt{"minedRemIndex"}]}$            \tcc*{Get index of the first output representing mined coins}%
%				$\cbsOutIndex \gets {\Out^{\cbs}_{i}[\keyInp]}$                               \tcc*{Get index of the output referenced by $i$}%
%				\lIf(                                                                         \tcc*[f]{Input $i$ spent an output representing fees}%
%				){$ \cbsOutIndex < \minedRemIndex$
%				}{continue}%
%				\If(                                                                          \tcc*[f]{Input $i$ (partly) represents mined coins}%
%				){$ \cbsOutIndex\,=\,\minedRemIndex$
%				}{%
%					$\MCirc \gets{\MCirc\,+\,\Out^{\cbs}_{i}[\mathtt{"minedRem"}]}$                   \tcc*{Add (partly) mined coins referenced by $i$}%
%				}
%			}(                                                                                \tcc*[f]{Input $i$ represents mined coins}%
%			){%
%				$\MCirc \gets{\MCirc\,+\,\val(i)}$                                                   \tcc*{Add mined coins referenced by $i$}%
%			}%
			\If(                                                                                 \tcc*[f]{Input $i$ references a coinbase output representing mined coins}){%
				$\reprMinedCoins(i)$
			}{%
				$\MCirc \gets{\MCirc\,+\,\valMinedCoinsPart(i)}$                                            \tcc*{Add part of value of $i$ that represents mined coins}%
			}%
		}%
	}%
	return $\MCirc$                                                                           \tcc*{Result: Return measured money in circulation with lookback window $\wndw$}%
\end{algorithm*}%
\else%
\fi%
